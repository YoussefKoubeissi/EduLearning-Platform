<!DOCTYPE html>
<html lang="en" dir="ltr">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible"
              content="IE=edge">
        <meta name="viewport"
              content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Take Course</title>

        <!-- Prevent the demo from appearing in search engines -->
        <meta name="robots"
              content="noindex">

        <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CRoboto:400,500%7CExo+2:600&display=swap"
              rel="stylesheet">

        <!-- Preloader -->
        <link type="text/css"
              href="../../public/vendor/spinkit.css"
              rel="stylesheet">

        <!-- Perfect Scrollbar -->
        <link type="text/css"
              href="../../public/vendor/perfect-scrollbar.css"
              rel="stylesheet">

        <!-- Material Design Icons -->
        <link type="text/css"
              href="../../public/css/material-icons.css"
              rel="stylesheet">

        <!-- Font Awesome Icons -->
        <link type="text/css"
              href="../../public/css/fontawesome.css"
              rel="stylesheet">

        <!-- Preloader -->
        <link type="text/css"
              href="../../public/css/preloader.css"
              rel="stylesheet">

        <!-- App CSS -->
        <link type="text/css"
              href="../../public/css/app.css"
              rel="stylesheet">

    </head>

    <body class="layout ">

        <div class="preloader">
            <div class="sk-chase">
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
            </div>

            <!-- <div class="sk-bounce">
                <div class="sk-bounce-dot"></div>
                <div class="sk-bounce-dot"></div>
            </div> -->

            <!-- More spinner examples at https://github.com/tobiasahlin/SpinKit/blob/master/examples.html -->
        </div>

        <!-- Drawer Layout -->

        <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px">
            <div class="mdk-drawer-layout__content page-content">

                <!-- Header -->
                <div id="HeaderDiv"></div>
                <!-- // END Header -->

                <!-- BEFORE Page Content -->

                <!-- // END BEFORE Page Content -->

                <!-- Page Content -->

                <div class="mdk-box bg-primary mdk-box--bg-gradient-primary2 js-mdk-box mb-0" data-effects="blend-background">
                    <div class="mdk-box__content">

                        <div class="hero py-64pt text-center text-sm-left">

                            <div class="container-fluid page__container">
                                <h1 class="text-white" id="CourseName"></h1>
                                <p class="lead text-white-50 measure-hero-lead mb-24pt" id="CourseDescription"></p>
                                <a href="student-take-lesson.html" class="btn btn-white">Resume course</a>
                            </div>

                        </div>

                        <div class="navbar navbar-expand-sm navbar-light bg-white border-bottom-2 navbar-list p-0 m-0 align-items-center">
                            <div class="container-fluid page__container">
                                <ul class="nav navbar-nav flex align-items-sm-center">
                                    <li class="nav-item navbar-list__item">
                                        <div class="media align-items-center">
                                            <span class="media-left mr-16pt">
                                                <img src="" width="40" alt="avatar" id="TrainerProfilePic" class="rounded-circle">
                                            </span>
                                            <div class="media-body">
                                                <a class="card-title m-0"
                                                   href="teacher-profile.html" id="TrainerName"></a>
                                                <p class="text-50 lh-1 mb-0">Instructor</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="nav-item navbar-list__item">
                                        <i class="material-icons text-muted icon--left">schedule</i>
                                        <span id="CourseDuration"></span>
                                    </li>
                                    <li class="nav-item navbar-list__item">
                                        <i class="material-icons text-muted icon--left">assessment</i>
                                        Beginner
                                    </li>
                                    <li class="nav-item ml-sm-auto text-sm-center flex-column navbar-list__item">
                                        <div class="rating rating-24">
                                            <div class="rating__item"><i class="material-icons">star</i></div>
                                            <div class="rating__item"><i class="material-icons">star</i></div>
                                            <div class="rating__item"><i class="material-icons">star</i></div>
                                            <div class="rating__item"><i class="material-icons">star</i></div>
                                            <div class="rating__item"><i class="material-icons">star_border</i></div>
                                        </div>
                                        <p class="lh-1 mb-0"><small class="text-muted">20 ratings</small></p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container-fluid page__container">
                    <div class="row">
                        <div class="col-lg-7">
                            <div class="border-left-2 page-section pl-32pt" id="parent">

                                <!-- <div class="d-flex align-items-center page-num-container">
                                    <div class="page-num">${chapternumber}</div>
                                    <h4>${chaptername}</h4>
                                </div>

                                <p class="text-70 mb-24pt">${chapterdescription}</p>

                                <div class="card mb-32pt mb-lg-64pt">
                                    <ul class="accordion accordion--boxed js-accordion mb-0" id="toc-${chapterID}">
                                        <li class="accordion__item open">
                                            <a class="accordion__toggle" data-toggle="collapse" data-parent="#toc-${chapterID}"
                                               href="#toc-content-${chapterID}">
                                                <span class="flex">1 of 4 Steps</span>
                                                <span class="accordion__toggle-icon material-icons">keyboard_arrow_down</span>
                                            </a>

                                            <div class="accordion__menu">

                                                <ul class="list-unstyled collapse show" id="toc-content-${chapterID}">
                                                    <li class="accordion__menu-link">
                                                        <span class="material-icons icon-16pt icon--left text-body">play_circle_outline</span>
                                                        <a class="flex" href="student-take-lesson.html">${partname}</a>
                                                        <span class="text-muted">${partduration}</span>
                                                    </li>
                                                </ul>

                                            </div>
                                        </li>
                                    </ul>
                                </div> -->

                            </div>
                        </div>

                        <div class="col-lg-5 page-nav">
                            <div class="page-section">

                                <div class="page-nav__content">
                                    <div class="page-separator">
                                        <div class="page-separator__text">Table of contents</div>
                                    </div>
                                    <!-- <h4 class="mb-16pt">Table of contents</h4> -->
                                </div>

                                <nav class="nav page-nav__menu" id="TableofContentNav">

                                    <!-- <a class="nav-link active" href="">Getting Started With Angular</a> -->

                                </nav>

                            </div>
                        </div>
                        
                    </div>
                </div>

                <!-- jQuery -->
                <script src="../../public/vendor/jquery.min.js"></script>

                <script>
                    $(document).ready(function(){

                        let CourseHead = "CourseHead";
                        let CourseChapters = "CourseChapters";
                        let apiURL = "../../api/";
                        let mins = 0;
                        let secs = 0;
                        let hours = 0;
                        let CourseDuration;

                        // Function to get the value of a query parameter from the URL using jQuery
                        function getQueryParam(name) {
                            const urlParams = new URLSearchParams(window.location.search);
                            return urlParams.get(name);
                        }
                        // Get the TrainerID from the URL
                        let courseID = getQueryParam("CourseID");
                        //console.log(courseID);

                        $.ajax({
                            url: "../../api/GetCourseInfo.php",
                            data: {
                                operation: CourseHead,
                                CourseID: courseID

                            },
                            type: "post",
                            dataType: "json",
                            success: function (response) {
                                //console.log(response);
                                // Access and use the returned data here:
                                let course = response[0]; // assuming 'data' contains a single user object
                                    
                                // Extract individual values into variables:
                                let courseID = course.CourseID;
                                //console.log(courseID);

                                let trainername = course.TrainerName;
                                $("#TrainerName").html(trainername);
                                //console.log(trainername);

                                let coursename = course.CourseName;
                                $("#CourseName").html(coursename);
                                //console.log(coursename);

                                let coursedescription = course.CourseDescription;
                                $("#CourseDescription").html(coursedescription);
                                //console.log(coursedescription);

                                let userProfilePic = course.UserProfilePic;
                                userProfilePic = apiURL + userProfilePic;
                                $("#TrainerProfilePic").attr('src', userProfilePic);
                                //console.log(userProfilePic);

                                $.each(response, function (index, course) {

                                    let coursemin = course.VideoMin;
                                    //console.log(coursemin);

                                    mins = coursemin + mins;
                                    //console.log(mins);

                                    let coursesec = course.VideoSec;
                                    //console.log(coursesec);

                                    secs = coursesec + secs;
                                    //console.log(secs);

                                });

                                if (secs >= 60){
                                    while (secs >= 60){
                                        secs = secs - 60;
                                        mins = mins + 1;
                                    }
                                }

                                if (mins >= 60){
                                    while (mins >= 60){
                                        mins = mins - 60;
                                        hours = hours + 1;
                                    }
                                }

                                if (hours > 0){
                                    CourseDuration = hours + "h " + mins + "m " + secs + "s";
                                    $("#CourseDuration").html(CourseDuration);
                                    //console.log(CourseDuration);
                                }
                                else if (mins > 0){
                                    CourseDuration = mins + "m " + secs + "s";
                                    $("#CourseDuration").html(CourseDuration);
                                    //console.log(CourseDuration);
                                }
                                else {
                                    CourseDuration = secs + "s";
                                    $("#CourseDuration").html(CourseDuration);
                                    //console.log(CourseDuration);
                                }

                            },
                            error: function (E) {
                                alert(E.status + E.statusText)
                            }
                        });

                        $.ajax({
                            url: "../../api/GetCourseInfo.php",
                            data: {
                                operation: CourseChapters,
                                CourseID: courseID

                            },
                            type: "post",
                            dataType: "json",
                            success: function (response) {
                                //console.log(response);
                                
                                let processedchapters = {};

                                let partsnumber;

                                let ChapterNumber = 1;

                                $.each(response, function (index, chapter) {

                                    let chapterID = chapter.ChapterID;

                                    let partname = chapter.PartName;

                                    if (partname != null){
                                        if (!processedchapters[chapterID]){
                                            processedchapters[chapterID] = true;

                                            //let chapternumber = chapter.ChapterNumber;

                                            let chaptername = chapter.ChapterName;

                                            let chapterdescription = chapter.ChapterDescription;

                                            let chapterDiv = `
                                            <div class="d-flex align-items-center page-num-container">
                                                <div class="page-num">${ChapterNumber}</div>
                                                <h4>${chaptername}</h4>
                                            </div>

                                            <p class="text-70 mb-24pt">${chapterdescription}</p>

                                            <div class="card mb-32pt mb-lg-64pt">
                                                <ul class="accordion accordion--boxed js-accordion mb-0" id="toc-${chapterID}">
                                                    <li class="accordion__item open">
                                                        <a class="accordion__toggle" data-toggle="collapse" data-parent="#toc-${chapterID}"
                                                        href="#toc-content-${chapterID}">
                                                            <span class="flex" id="PartNumber-${chapterID}"></span>
                                                            <span class="accordion__toggle-icon material-icons">keyboard_arrow_down</span>
                                                        </a>

                                                        <div class="accordion__menu">

                                                            <ul class="list-unstyled collapse show" id="toc-content-${chapterID}">
                                                                
                                                            </ul>

                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>`;

                                            ChapterNumber = ChapterNumber + 1;
                                            //console.log(ChapterNumber);

                                            $("#parent").append(chapterDiv);

                                            let TalbeofContentNav = `<a class="nav-link" href=""><b>${chaptername}</b></a>`;

                                            $("#TableofContentNav").append(TalbeofContentNav);

                                            partsnumber = 1;
                                        }

                                        let partID = chapter.PartID;

                                        let partname = chapter.PartName;

                                        let partnumber = partsnumber++;
                                        //console.log(partnumber);
                                        
                                        $(`#PartNumber-${chapterID}`).html(partnumber + " Steps");

                                        let chaptermin = chapter.VideoMin;

                                        let chaptersec = chapter.VideoSec;

                                        let partduration = chaptermin + "m " + chaptersec + "s";

                                        let partDiv = `<li class="accordion__menu-link">
                                                            <span class="material-icons icon-16pt icon--left text-body">play_circle_outline</span>
                                                            <a class="flex" href="TakeLesson.html?PartID=${partID}&CourseID=${courseID}">${partname}</a>
                                                            <span class="text-muted">${partduration}</span>
                                                        </li>`;

                                        $(`#toc-content-${chapterID}`).append(partDiv);

                                    }
                                });

                            },
                            error: function (E) {
                                alert(E.status + E.statusText)
                            }
                        });

                    });
                    
                </script>

                <!-- // END Page Content -->

                <!-- Footer -->
                <div id="FooterDiv"></div>
                <!-- // END Footer -->

            </div>

            <!-- // END drawer-layout__content -->

            <!-- Drawer -->
            <!-- // END Drawer -->

        </div>

        <!-- // END Drawer Layout -->

        <!-- Bootstrap -->
        <script src="../../public/vendor/popper.min.js"></script>
        <script src="../../public/vendor/bootstrap.min.js"></script>

        <!-- Perfect Scrollbar -->
        <script src="../../public/vendor/perfect-scrollbar.min.js"></script>

        <!-- DOM Factory -->
        <script src="../../public/vendor/dom-factory.js"></script>

        <!-- MDK -->
        <script src="../../public/vendor/material-design-kit.js"></script>

        <!-- App JS -->
        <script src="../../public/js/app.js"></script>
        <script src="Header.js"></script>
        <script src="Footer.js"></script>

        <!-- Preloader -->
        <script src="../../public/js/preloader.js"></script>

    </body>

</html>